app-id: radio.k0swe.Kel_Agent
runtime: org.freedesktop.Platform
runtime-version: '20.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang
build-options:
  append-path: /usr/lib/sdk/golang/bin
  env:
    - LDFLAGS=
command: kel-agent
finish-args:
  - --share=network
modules:
  - name: kel-agent
    sources:
      - type: git
        url: https://github.com/adrg/xdg.git
        tag: v0.4.0
        commit: 4ec40e24f0cf1039f93c773f2984decdea9719b5
        dest: vendor/github.com/adrg/xdg/
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
          version-scheme: semantic

      - type: git
        url: https://github.com/gorilla/websocket.git
        tag: v1.4.2
        commit: b65e62901fc1c0d968042419e74789f6af455eb9
        dest: vendor/github.com/gorilla/websocket/
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
          version-scheme: semantic

      - type: git
        url: https://github.com/imdario/mergo.git
        tag: v0.3.12
        commit: 29fb3d3bdc5512887f1dc9aedde6a0fed407fa8f
        dest: vendor/github.com/imdario/mergo/
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
          version-scheme: semantic

      - type: git
        url: https://github.com/k0swe/wsjtx-go.git
        tag: v3.0.0
        commit: 17dbc1088898b85360c16fcb7711e182db13afce
        dest: vendor/github.com/k0swe/wsjtx-go/v3/
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
          version-scheme: semantic

      - type: git
        url: https://github.com/rs/zerolog.git
        tag: v1.26.0
        commit: 6973188a7402be93e3b27e318eac70d67cbbf1bd
        dest: vendor/github.com/rs/zerolog/
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
          version-scheme: semantic

      - type: git
        url: https://github.com/leemcloughlin/jdn.git
        commit: 6f88db6a6bf2176674100d1a1c692596fcf6e2ba
        dest: vendor/github.com/leemcloughlin/jdn/

      - type: git
        url: https://github.com/go-yaml/yaml.git
        tag: v2.4.0
        commit: 7649d4548cb53a614db133b2a8ac1f31859dda8c
        dest: vendor/gopkg.in/yaml.v2/
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
          version-scheme: semantic

      - type: git
        url: https://github.com/k0swe/kel-agent.git
        tag: v0.4.3
        commit: 6450bf748ee6c4c95232ae2ec3efda96d0887fff
        x-checker-data:
          type: json
          url: https://api.github.com/repos/k0swe/kel-agent/releases/latest
          tag-query: .tag_name
          version-query: $tag | sub("^v"; "")
          timestamp-query: .published_at

    buildsystem: simple
    build-commands:
      - cp assets/modules.txt vendor/
      - make -j$FLATPAK_BUILDER_N_JOBS
      - install -D kel-agent /app/bin/kel-agent
      - install -Dm644 assets/radio.k0swe.Kel_Agent.svg /app/share/icons/hicolor/scalable/apps/radio.k0swe.Kel_Agent.svg
      - install -Dm644 assets/radio.k0swe.Kel_Agent.metainfo.xml /app/share/metainfo/radio.k0swe.Kel_Agent.metainfo.xml
      - install -Dm644 assets/radio.k0swe.Kel_Agent.desktop /app/share/applications/radio.k0swe.Kel_Agent.desktop
